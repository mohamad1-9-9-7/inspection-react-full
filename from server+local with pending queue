[1mdiff --git a/src/pages/ReturnView.js b/src/pages/ReturnView.js[m
[1mindex bb03a09..950de3f 100644[m
[1m--- a/src/pages/ReturnView.js[m
[1m+++ b/src/pages/ReturnView.js[m
[36m@@ -12,13 +12,44 @@[m [masync function fetchReturns() {[m
   return Array.isArray(json) ? json : (json && json.data ? json.data : []);[m
 }[m
 [m
[31m-/* ğŸ†• Ø­Ø°Ù ØªÙ‚Ø§Ø±ÙŠØ± ÙŠÙˆÙ… Ù…Ø¹ÙŠÙ‘Ù† Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ± (Ù…Ø­Ø³Ù‘Ù†Ø© Ù…Ø¹ fallback) */[m
[31m-// ÙŠØ­Ø§ÙˆÙ„ Ø£ÙƒØ«Ø± Ù…Ù† Ù…Ø³Ø§Ø± Ù„Ù„Ø­Ø°Ù (Ù„ØªÙØ§Ø¯ÙŠ 404) ÙˆÙŠØªØ­Ù…Ù‘Ù„ Ø±Ø¯Ù‘ ØºÙŠØ± JSON[m
[31m-async function deleteReturnsByDate(reportDate) {[m
[32m+[m[32m/* ğŸ†• Ù‚Ø§Ø¦Ù…Ø© Ø§Ù†ØªØ¸Ø§Ø± ØªÙˆØ§Ø±ÙŠØ® Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø­Ø°Ù Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙŠØ±ÙØ± (Ù„Ù…Ù†Ø¹ Ø±Ø¬ÙˆØ¹Ù‡Ø§ Ù„Ù„ÙˆØ§Ø¬Ù‡Ø©) */[m
[32m+[m[32mconst LS_KEY_PENDING = "returns_pending_server_deletes";[m
[32m+[m[32mfunction readPending() {[m
[32m+[m[32m  try { return JSON.parse(localStorage.getItem(LS_KEY_PENDING) || "[]"); } catch { return []; }[m
[32m+[m[32m}[m
[32m+[m[32mfunction writePending(arr) {[m
[32m+[m[32m  localStorage.setItem(LS_KEY_PENDING, JSON.stringify([...new Set(arr)]));[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m/* ğŸ†• Ø­Ø°Ù Ù…Ø­Ù„ÙŠ Ù„ØªØ§Ø±ÙŠØ® Ù…Ø¹ÙŠÙ‘Ù†: ÙŠÙ†Ø¸Ù‘Ù returns_reports Ùˆ returns_sync_queue */[m
[32m+[m[32mfunction deleteLocalReturnsByDate(reportDate) {[m
[32m+[m[32m  let localDeleted = 0;[m
[32m+[m
[32m+[m[32m  // returns_reports Ø§Ù„Ù…Ø®Ø²Ù†Ø© Ù…Ø­Ù„ÙŠÙ‹Ø§[m
[32m+[m[32m  try {[m
[32m+[m[32m    const arr = JSON.parse(localStorage.getItem("returns_reports") || "[]");[m
[32m+[m[32m    const before = arr.length;[m
[32m+[m[32m    const filtered = arr.filter((r) => (r.reportDate || r?.payload?.reportDate) !== reportDate);[m
[32m+[m[32m    localDeleted = before - filtered.length;[m
[32m+[m[32m    localStorage.setItem("returns_reports", JSON.stringify(filtered));[m
[32m+[m[32m  } catch {}[m
[32m+[m
[32m+[m[32m  // Ø·Ø§Ø¨ÙˆØ± Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© (Ù„Ùˆ ÙÙŠ Ø¹Ù†Ø§ØµØ± Ø¨Ù†ÙØ³ Ø§Ù„ØªØ§Ø±ÙŠØ®)[m
[32m+[m[32m  try {[m
[32m+[m[32m    const q = JSON.parse(localStorage.getItem("returns_sync_queue") || "[]");[m
[32m+[m[32m    const qFiltered = q.filter((it) => it?.reportDate !== reportDate);[m
[32m+[m[32m    localStorage.setItem("returns_sync_queue", JSON.stringify(qFiltered));[m
[32m+[m[32m  } catch {}[m
[32m+[m
[32m+[m[32m  return localDeleted;[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m/* ğŸ†• Ø­Ø°Ù Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ± Ø¨Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ù…ØªØ¹Ø¯Ø¯Ø© Ù„Ù…Ø³Ø§Ø±Ø§Øª Ù…Ø®ØªÙ„ÙØ© + ØªØ­Ù…Ù‘Ù„ 204/HTML */[m
[32m+[m[32masync function deleteReturnsOnServer(reportDate) {[m
   const attempts = [[m
     API_BASE + "/api/reports?type=returns&reportDate=" + encodeURIComponent(reportDate), // Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ù‚Ø¯ÙŠÙ…[m
     API_BASE + "/api/reports/returns?reportDate=" + encodeURIComponent(reportDate),      // Ù…Ø³Ø§Ø± Ø¨Ø¯ÙŠÙ„[m
[31m-    API_BASE + "/returns?reportDate=" + encodeURIComponent(reportDate)                   // Ù…Ø³Ø§Ø± Ø£Ø¨Ø³Ø·[m
[32m+[m[32m    API_BASE + "/returns?reportDate=" + encodeURIComponent(reportDate),                  // Ù…Ø³Ø§Ø± Ø£Ø¨Ø³Ø·[m
   ];[m
 [m
   let lastErr = null;[m
[36m@@ -33,25 +64,38 @@[m [masync function deleteReturnsByDate(reportDate) {[m
           if (json && (json.ok === true || typeof json.deleted !== "undefined")) {[m
             return Number(json.deleted || 1);[m
           }[m
[31m-          return 1;[m
[32m+[m[32m          return 1; // Ø±Ø¯ ØºÙŠØ± Ù‚ÙŠØ§Ø³ÙŠ Ø¨Ø³ Ù†Ø§Ø¬Ø­[m
         } catch {[m
[31m-          // Ø±Ø¯ ØºÙŠØ± JSON (Ù…Ø«Ù„Ø§Ù‹ 204 No Content) => Ù†Ø¬Ø§Ø­[m
[31m-          return 1;[m
[32m+[m[32m          return 1; // 204/HTML[m
         }[m
       }[m
[31m-      // Ù„Ùˆ 404 Ø¬Ø±Ù‘Ø¨ Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„ØªØ§Ù„ÙŠ[m
[31m-      if (res.status === 404) continue;[m
[31m-[m
[32m+[m[32m      if (res.status === 404) continue; // Ø¬Ø±Ù‘Ø¨ Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„ØªØ§Ù„ÙŠ[m
       const text = await res.text().catch(() => "");[m
[31m-      throw new Error(`DELETE failed ${res.status}: ${text}`);[m
[32m+[m[32m      lastErr = new Error(`DELETE failed ${res.status}: ${text}`);[m
     } catch (e) {[m
       lastErr = e;[m
     }[m
   }[m
 [m
[31m-  throw lastErr || new Error("No matching DELETE route on server");[m
[32m+[m[32m  if (lastErr) throw lastErr;[m
[32m+[m[32m  throw new Error("No matching DELETE route on server");[m
 }[m
 [m
[32m+[m[32m/* ğŸ†• Ù…Ù†Ø³Ù‘Ù‚: ÙŠØ­Ø°Ù Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ± Ø«Ù… Ù…Ù† Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠØŒ ÙˆÙŠØ¹ÙŠØ¯ Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø§Ø«Ù†ÙŠÙ† + Ø§Ù„Ø®Ø·Ø£ Ø¥Ù† ÙˆØ¬Ø¯ */[m
[32m+[m[32masync function deleteReturnsByDate(reportDate) {[m
[32m+[m[32m  let serverDeleted = 0;[m
[32m+[m[32m  let serverError = null;[m
[32m+[m
[32m+[m[32m  try {[m
[32m+[m[32m    serverDeleted = await deleteReturnsOnServer(reportDate);[m
[32m+[m[32m  } catch (e) {[m
[32m+[m[32m    serverError = e;[m
[32m+[m[32m  }[m
[32m+[m
[32m+[m[32m  const localDeleted = deleteLocalReturnsByDate(reportDate);[m
[32m+[m
[32m+[m[32m  return { serverDeleted, localDeleted, error: serverError?.message || null };[m
[32m+[m[32m}[m
 [m
 /* ØªÙˆØ­ÙŠØ¯ Ø§Ù„Ø´ÙƒÙ„: Ø¥Ù† ÙƒØ§Ù†Øª Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø§Ù„ÙØ¹Ù„ Ø¨Ø§Ù„Ø´ÙƒÙ„ [{reportDate, items:[]}] Ù†ÙØ¹ÙŠØ¯Ù‡Ø§ ÙƒÙ…Ø§ Ù‡ÙŠ.[m
    ÙˆØ¥Ù„Ø§ Ù†Ø­ÙˆÙ‘Ù„ Ù…Ù† Ø´ÙƒÙ„ Ø§Ù„Ø³ÙŠØ±ÙØ± [{ payload:{reportDate, items[]} ...}] Ø¥Ù„Ù‰ Ù†ÙØ³ Ø§Ù„Ø´ÙƒÙ„ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹ Ù…Ø­Ù„ÙŠÙ‹Ø§. */[m
[36m@@ -125,7 +169,7 @@[m [mexport default function ReturnView() {[m
     setReports(data);[m
   }, []);[m
 [m
[31m-  /* ========== Ø¬Ù„Ø¨ Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ± Ø«Ù… ØªÙˆØ­ÙŠØ¯ Ø§Ù„Ø´ÙƒÙ„ ========== */[m
[32m+[m[32m  /* ========== Ø¬Ù„Ø¨ Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ± Ø«Ù… ØªÙˆØ­ÙŠØ¯ Ø§Ù„Ø´ÙƒÙ„ + ØªØµÙÙŠØ© Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø¹Ù„Ù‘ÙÙ…Ø© pending ========== */[m
   async function reloadFromServer() {[m
     setServerErr("");[m
     setLoadingServer(true);[m
[36m@@ -133,7 +177,16 @@[m [mexport default function ReturnView() {[m
       const raw = await fetchReturns();[m
       const normalized = normalizeServerReturns(raw);[m
       normalized.sort((a, b) => (b.reportDate || "").localeCompare(a.reportDate || ""));[m
[31m-      setReports(function (prev) { return (normalized && normalized.length ? normalized : prev); });[m
[32m+[m
[32m+[m[32m      // ØµÙÙ‘ÙŠ Ø£ÙŠ ØªÙ‚Ø±ÙŠØ± ØªØ§Ø±ÙŠØ®ÙÙ‡ Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±[m
[32m+[m[32m      const pending = readPending();[m
[32m+[m[32m      const filteredNormalized = normalized.filter([m
[32m+[m[32m        (r) => !pending.includes(r.reportDate)[m
[32m+[m[32m      );[m
[32m+[m
[32m+[m[32m      setReports(function (prev) {[m
[32m+[m[32m        return (filteredNormalized && filteredNormalized.length ? filteredNormalized : prev);[m
[32m+[m[32m      });[m
     } catch (e) {[m
       setServerErr("ØªØ¹Ø°Ø± Ø§Ù„Ø¬Ù„Ø¨ Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ± Ø§Ù„Ø¢Ù†. (Ù‚Ø¯ ÙŠÙƒÙˆÙ† Ø§Ù„Ø³ÙŠØ±ÙØ± ÙŠØ³ØªÙŠÙ‚Ø¸).");[m
       console.error(e);[m
[36m@@ -249,39 +302,52 @@[m [mexport default function ReturnView() {[m
     });[m
   }, [filteredReports]);[m
 [m
[31m-  // ğŸ†• Ø­Ø°Ù ØªÙ‚Ø±ÙŠØ± Ø¨Ø­Ø³Ø¨ Ø§Ù„ØªØ§Ø±ÙŠØ® (ÙŠØ­Ø°Ù Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ± Ø£ÙˆÙ„Ø§Ù‹ Ø«Ù… ÙŠØ­Ø¯Ù‘Ø« Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø­Ù„ÙŠØ©)[m
[32m+[m[32m  // ğŸ†• Ø­Ø°Ù ØªÙ‚Ø±ÙŠØ± Ø¨Ø­Ø³Ø¨ Ø§Ù„ØªØ§Ø±ÙŠØ®:[m
[32m+[m[32m  // - ÙŠØ­Ø§ÙˆÙ„ Ø§Ù„Ø­Ø°Ù Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±[m
[32m+[m[32m  // - ÙŠØ­Ø°Ù Ù…Ø­Ù„ÙŠÙ‹Ø§ Ø¯ÙˆÙ…Ù‹Ø§[m
[32m+[m[32m  // - Ù„Ùˆ ÙØ´Ù„ Ø§Ù„Ø³ÙŠØ±ÙØ±: ÙŠØ¶ÙŠÙ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø¥Ù„Ù‰ pending Ù„Ø¥Ø®ÙØ§Ø¦Ù‡ØŒ ÙˆÙŠÙØ¹Ø§Ø¯ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø­Ù‚Ù‹Ø§ ÙŠØ¯ÙˆÙŠÙ‹Ø§[m
   const handleDeleteByDate = async (dateStr) => {[m
[31m-    if (!window.confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù ØªÙ‚Ø±ÙŠØ± " + dateStr + "ØŸ")) return;[m
[32m+[m[32m    if (!window.confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù ØªÙ‚Ø±ÙŠØ± " + dateStr + " Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ± ÙˆØ§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠØŸ")) return;[m
 [m
     try {[m
[31m-      setOpMsg("â³ Ø¬Ø§Ø±ÙŠ Ø­Ø°Ù ØªÙ‚Ø±ÙŠØ± " + dateStr + " Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±â€¦");[m
[31m-      const deleted = await deleteReturnsByDate(dateStr); // â† Ø­Ø°Ù Ù