import React, { useState, useEffect } from "react";

export default function QCSRawMaterialInspection() {
  const [samples, setSamples] = useState([
    {
      temperature: "", ph: "", slaughterDate: "", expiryDate: "",
      broken: "", appearance: "", bloodClots: "", colour: "",
      fatDiscoloration: "", meatDamage: "", foreignMatter: "",
      texture: "", testicles: "", smell: ""
    },
  ]);

  const [reportTitle, setReportTitle] = useState("");
  const [shipmentStatus, setShipmentStatus] = useState("Ù…Ø±Ø¶ÙŠ");
  const [verifiedBy1, setVerifiedBy1] = useState("");
  const [verifiedBy2, setVerifiedBy2] = useState("");

  const [totalQuantity, setTotalQuantity] = useState("");
  const [totalWeight, setTotalWeight] = useState("");
  const [averageWeight, setAverageWeight] = useState("0");

  const [generalInfo, setGeneralInfo] = useState({
    reportOn: "", receivedOn: "", inspectionDate: "",
    temperature: "", brand: "", invoiceNo: "",
    ph: "", origin: "", airwayBill: "",
    localLogger: "N/A", internationalLogger: "N/A"
  });

  useEffect(() => {
    const q = parseFloat(totalQuantity);
    const w = parseFloat(totalWeight);
    if (q > 0 && w > 0) {
      setAverageWeight((w / q).toFixed(3)); // Ù…ØªÙˆØ³Ø· Ø§Ù„ÙˆØ²Ù† Ø¨Ø§Ù„ÙƒÙŠÙ„Ùˆ
    } else {
      setAverageWeight("0");
    }
  }, [totalQuantity, totalWeight]);

  const handleSampleChange = (index, field, value) => {
    const updated = [...samples];
    updated[index][field] = value;
    setSamples(updated);
  };

  const handleGeneralChange = (field, value) => {
    setGeneralInfo((prev) => ({ ...prev, [field]: value }));
  };

  const addSample = () => {
    setSamples((prev) => [
      ...prev,
      {
        temperature: "", ph: "", slaughterDate: "", expiryDate: "",
        broken: "", appearance: "", bloodClots: "", colour: "",
        fatDiscoloration: "", meatDamage: "", foreignMatter: "",
        texture: "", testicles: "", smell: ""
      }
    ]);
  };

  const handleSave = () => {
    if (!reportTitle.trim()) {
      alert("ğŸ“ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¹Ù†ÙˆØ§Ù† Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„ØªÙ‚Ø±ÙŠØ±.");
      return;
    }

    if (!verifiedBy1.trim()) {
      alert("ğŸ›‘ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ø´Ø®Øµ Ø§Ù„Ø°ÙŠ Ù‚Ø§Ù… Ø¨Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ø£ÙˆÙ„ (Verified By 1).");
      return;
    }

    const allReports = JSON.parse(localStorage.getItem("qcs_raw_material_reports") || "[]");

    const newReport = {
      id: Date.now(),
      title: reportTitle,
      status: shipmentStatus,
      generalInfo,
      date: new Date().toLocaleString(),
      samples,
      verifiedBy1,
      verifiedBy2,
      totalQuantity,
      totalWeight,
      averageWeight
    };

    allReports.push(newReport);
    localStorage.setItem("qcs_raw_material_reports", JSON.stringify(allReports));
    alert("âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø¨Ù†Ø¬Ø§Ø­");
    setReportTitle("");
    setSamples([samples[0]]);
    setVerifiedBy1("");
    setVerifiedBy2("");
    setTotalQuantity("");
    setTotalWeight("");
    setAverageWeight("0");
  };

  return (
    <div style={{
      padding: "2rem",
      background: "#fff",
      borderRadius: "12px",
      marginTop: "2rem",
      direction: "rtl",
      fontFamily: "Cairo, sans-serif"
    }}>
      <h2 style={{ color: "#2c3e50", marginBottom: "1.5rem" }}>
        ğŸ“¦ ØªÙ‚Ø±ÙŠØ± Ø§Ø³ØªÙ„Ø§Ù… Ø´Ø­Ù†Ø§Øª - QCS
      </h2>

      <div style={{ marginBottom: "1.5rem" }}>
        <label style={{ fontWeight: "bold" }}>
          ğŸ“Œ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙ‚Ø±ÙŠØ± (Report Title):
        </label>
        <input
          value={reportTitle}
          onChange={(e) => setReportTitle(e.target.value)}
          placeholder="Ù…Ø«Ø§Ù„: Ø´Ø­Ù†Ø© Ø±Ù‚Ù… 3 - ØªØ§Ø±ÙŠØ® 28/07"
          style={{
            width: "60%",
            padding: "10px",
            marginRight: "0.5rem",
            border: "1px solid #ccc",
            borderRadius: "6px"
          }}
        />
      </div>

      <fieldset style={{
        marginBottom: "2rem",
        padding: "1.5rem",
        border: "1px solid #ccc",
        borderRadius: "10px"
      }}>
        <legend style={{ fontWeight: "bold", fontSize: "1.1rem" }}>
          ğŸ“‹ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¹Ø§Ù…Ø© Ø¹Ù† Ø§Ù„ØªÙ‚Ø±ÙŠØ± (General Information)
        </legend>

        <div style={{
          display: "grid",
          gridTemplateColumns: "repeat(auto-fit, minmax(250px, 1fr))",
          gap: "1rem",
          marginTop: "1rem"
        }}>
          {[
            ["ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø±ÙŠØ± (Report On)", "reportOn"],
            ["ğŸ“¥ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… (Sample Received On)", "receivedOn"],
            ["ğŸ” ØªØ§Ø±ÙŠØ® Ø§Ù„ÙØ­Øµ (Inspection Date)", "inspectionDate"],
            ["ğŸŒ¡ï¸ Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø© (Temperature)", "temperature"],
            ["ğŸ·ï¸ Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ© (Brand)", "brand"],
            ["ğŸ§¾ Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø© (Invoice No)", "invoiceNo"],
            ["ğŸ”¬ Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ù…ÙˆØ¶Ø© (PH)", "ph"],
            ["ğŸŒ Ø¨Ù„Ø¯ Ø§Ù„Ù…Ù†Ø´Ø£ (Origin)", "origin"],
            ["ğŸ“¦ Ø±Ù‚Ù… Ø¨ÙˆÙ„ÙŠØµØ© Ø§Ù„Ø´Ø­Ù† (Air Way Bill No)", "airwayBill"],
            ["ğŸ“¡ Ø¬Ù‡Ø§Ø² Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø­Ù„ÙŠ (Local Logger)", "localLogger"],
            ["ğŸŒ Ø¬Ù‡Ø§Ø² Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯ÙˆÙ„ÙŠ (International Logger)", "internationalLogger"]
          ].map(([label, field]) => (
            <div key={field}>
              <label>{label}:</label>
              <input
                value={generalInfo[field]}
                onChange={(e) => handleGeneralChange(field, e.target.value)}
                style={{
                  width: "100%",
                  padding: "8px",
                  border: "1px solid #ccc",
                  borderRadius: "6px"
                }}
              />
            </div>
          ))}
        </div>

        <div style={{ marginTop: "1.5rem" }}>
          <label style={{ fontWeight: "bold" }}>
            âš ï¸ Ø­Ø§Ù„Ø© Ø§Ù„Ø´Ø­Ù†Ø© (Shipment Status):
          </label>
          <select
            value={shipmentStatus}
            onChange={(e) => setShipmentStatus(e.target.value)}
            style={{
              padding: "8px",
              fontWeight: "bold",
              borderRadius: "6px",
              border: "1px solid #aaa"
            }}
          >
            <option>Ù…Ø±Ø¶ÙŠ</option>
            <option>ÙˆØ³Ø·</option>
            <option>ØªØ­Øª Ø§Ù„ÙˆØ³Ø·</option>
          </select>
        </div>
      </fieldset>

      <h4 style={{ marginBottom: "1rem" }}>ğŸ§ª Ø¹ÙŠÙ†Ø§Øª Ø§Ù„ÙØ­Øµ (Test Samples)</h4>

      <div style={{ overflowX: "auto" }}>
        <table style={{
          width: "100%",
          borderCollapse: "collapse",
          fontSize: "0.95rem"
        }}>
          <thead>
            <tr style={{ backgroundColor: "#f0f0f0", textAlign: "center" }}>
              <th>#</th>
              <th>Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø© (Temp)</th>
              <th>PH</th>
              <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø°Ø¨Ø­ (Slaughter Date)</th>
              <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ (Expiry)</th>
              <th>Ù‚Ø·Ø¹ Ù…ÙƒØ³ÙˆØ±Ø© (Broken)</th>
              <th>Ø§Ù„Ù…Ø¸Ù‡Ø± (Appearance)</th>
              <th>ØªØ¬Ù„Ø· Ø¯Ù… (Blood Clots)</th>
              <th>Ø§Ù„Ù„ÙˆÙ† (Colour)</th>
              <th>Ø´Ø­ÙˆÙ… Ù…ØªØºÙŠØ±Ø© (Fat Discoloration)</th>
              <th>ØªÙ„Ù Ø§Ù„Ù„Ø­Ù… (Meat Damage)</th>
              <th>Ù…ÙˆØ§Ø¯ ØºØ±ÙŠØ¨Ø© (Foreign Matter)</th>
              <th>Ø§Ù„Ù…Ù„Ù…Ø³ (Texture)</th>
              <th>Ø®ØµÙŠØªÙŠÙ† (Testicles)</th>
              <th>Ø±Ø§Ø¦Ø­Ø© ÙƒØ±ÙŠÙ‡Ø© (Smell)</th>
            </tr>
          </thead>
          <tbody>
            {samples.map((sample, idx) => (
              <tr key={idx} style={{ textAlign: "center", borderBottom: "1px solid #ddd" }}>
                <td>{idx + 1}</td>
                {Object.keys(sample).map((key) => (
                  <td key={key}>
                    <input
                      value={sample[key]}
                      onChange={(e) => handleSampleChange(idx, key, e.target.value)}
                      style={{
                        width: "100%",
                        padding: "6px",
                        border: "1px solid #ccc",
                        borderRadius: "4px"
                      }}
                    />
                  </td>
                ))}
              </tr>
            ))}

            <tr>
              <td colSpan="15" style={{ textAlign: "center", padding: "1rem" }}>
                <button
                  onClick={addSample}
                  style={{
                    padding: "8px 16px",
                    background: "#8e44ad",
                    color: "#fff",
                    border: "none",
                    borderRadius: "6px",
                    cursor: "pointer"
                  }}
                >
                  â• Ø¥Ø¶Ø§ÙØ© Ø¹ÙŠÙ†Ø© Ø¬Ø¯ÙŠØ¯Ø© (Add Sample)
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      {/* Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø¬Ø¯ÙˆÙ„ */}
      <div style={{
        marginTop: "1.5rem",
        display: "flex",
        gap: "1rem",
        alignItems: "center"
      }}>
        <div style={{ flex: 1 }}>
          <label style={{ fontWeight: "bold" }}>ğŸ“¦ Ø¹Ø¯Ø¯ Ø§Ù„Ø­Ø¨Ø§Øª Ø§Ù„ÙƒÙ„ÙŠ:</label>
          <input
            type="number"
            value={totalQuantity}
            onChange={(e) => setTotalQuantity(e.target.value)}
            placeholder="Ù…Ø«Ø§Ù„: 1000"
            style={{
              width: "100%",
              padding: "8px",
              border: "1px solid #ccc",
              borderRadius: "6px"
            }}
          />
        </div>
        <div style={{ flex: 1 }}>
          <label style={{ fontWeight: "bold" }}>âš–ï¸ ÙˆØ²Ù† Ø§Ù„Ø´Ø­Ù†Ø© Ø§Ù„ÙƒÙ„ÙŠ (ÙƒØ¬Ù…):</label>
          <input
            type="number"
            value={totalWeight}
            onChange={(e) => setTotalWeight(e.target.value)}
            placeholder="Ù…Ø«Ø§Ù„: 750"
            style={{
              width: "100%",
              padding: "8px",
              border: "1px solid #ccc",
              borderRadius: "6px"
            }}
          />
        </div>
        <div style={{ flex: 1 }}>
          <label style={{ fontWeight: "bold" }}>ğŸ”¢ Ù…ØªÙˆØ³Ø· ÙˆØ²Ù† Ø§Ù„Ø­Ø¨Ø© (ÙƒØ¬Ù…):</label>
          <input
            type="text"
            value={averageWeight}
            disabled
            style={{
              width: "100%",
              padding: "8px",
              background: "#f5f5f5",
              border: "1px solid #ccc",
              borderRadius: "6px"
            }}
          />
        </div>
      </div>

      <div style={{
        display: "flex",
        justifyContent: "space-between",
        marginTop: "2rem",
        gap: "1rem"
      }}>
        <div style={{ flex: 1 }}>
          <label style={{ fontWeight: "bold" }}>
            âœ… ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ø¨ÙˆØ§Ø³Ø·Ø© (Verified By 1):
          </label>
          <input
            value={verifiedBy1}
            onChange={(e) => setVerifiedBy1(e.target.value)}
            placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ù‚Ù‚ Ø§Ù„Ø£ÙˆÙ„"
            style={{
              width: "100%",
              padding: "10px",
              border: "1px solid #ccc",
              borderRadius: "6px"
            }}
          />
        </div>

        <div style={{ flex: 1 }}>
          <label style={{ fontWeight: "bold" }}>
            ğŸ“ ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ø¨ÙˆØ§Ø³Ø·Ø© (Verified By 2):
          </label>
          <input
            value={verifiedBy2}
            onChange={(e) => setVerifiedBy2(e.target.value)}
            placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ù‚Ù‚ Ø§Ù„Ø«Ø§Ù†ÙŠ"
            style={{
              width: "100%",
              padding: "10px",
              border: "1px solid #ccc",
              borderRadius: "6px"
            }}
          />
        </div>
      </div>

      <div style={{ marginTop: "2rem" }}>
        <button
          onClick={handleSave}
          style={{
            padding: "10px 24px",
            background: "#27ae60",
            color: "#fff",
            border: "none",
            borderRadius: "8px",
            cursor: "pointer"
          }}
        >
          ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªÙ‚Ø±ÙŠØ± (Save Report)
        </button>
      </div>
    </div>
  );
}
